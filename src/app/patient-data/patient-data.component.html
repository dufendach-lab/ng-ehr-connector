<mat-card class="patient-data-card">
  <mat-card-header>
    <mat-card-title>Patient Data</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="data-container" fxLayout="column" fxLayoutGap="15px">

      <div>
        <p>Deselect any data you want to withhold from Cincinnati Children's:</p>
        <mat-checkbox color="primary"
                      [checked]="allComplete"
                      [indeterminate]="someComplete()"
                      (change)="setAll($event.checked)">
          Select All
        </mat-checkbox>
      </div>
      <mat-accordion>

        <!-- VITAL SIGNS PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[0].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >equalizer</mat-icon>&nbsp;&nbsp;
                <span>Vital Signs</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div *ngIf="(vitalsBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
            <!-- <app-graph-data></app-graph-data> -->
          </div>
        </mat-expansion-panel>

        <!-- SOCIAL HISTORY PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[1].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon>groups</mat-icon>&nbsp;&nbsp;
                <span>Social History</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(socialBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- LABORATORY PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[2].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >science</mat-icon>&nbsp;&nbsp;
                <span>Laboratory</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(labBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- MEDICAL STATEMENT PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[3].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >medication</mat-icon> &nbsp;&nbsp;
                <span>Medical Statement</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(medBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- IMMUNIZATION PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[4].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >coronavirus</mat-icon>&nbsp;&nbsp;
                <span>Immunization</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <br>
          <div *ngIf="(immuneBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- CONDITIONS PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[5].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >local_hospital</mat-icon>&nbsp;&nbsp;
                <span>Conditions</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(conditionBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- PROCEDURES PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[6].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >healing</mat-icon>&nbsp;&nbsp;
                <span>Procedures</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(procedureBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- DOCUMENT PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[7].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <mat-icon >description</mat-icon>&nbsp;&nbsp;
                <span>Documents</span>

              </mat-checkbox>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(documentBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

      </mat-accordion>

      <button mat-raised-button color="primary" (click)="submitData()">Send to Cincinnati Children's</button>

    </div>
    <div class="graph-container">
      <div *ngIf="(vitalsBundle | async) as bundle; else loading">
        <app-graph-data [observations]="bundle"></app-graph-data>
      </div>

    </div>
  </mat-card-content>
</mat-card>

<ng-template #loading><br>Error retrieving information.</ng-template>
<ng-template #notcomplete>
  <mat-panel-description fxLayoutAlign="end">Not Selected</mat-panel-description>
</ng-template>
