<mat-card class="patient-data-card">
  <mat-card-header>
    <mat-card-title>Patient Data</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div class="data-container" fxLayout="column" fxLayoutGap="15px">

      <div style="padding-left: 1rem;">
        <h3>Heres what we were able to pull from MyChart. Select the data you would like to send CCHMC:</h3>
        <br>
        <mat-checkbox color="primary"
                      [checked]="allComplete"
                      [indeterminate]="someComplete()"
                      (change)="setAll($event.checked)">
          Select All
        </mat-checkbox>
      </div>
      <br>
      <mat-accordion>

        <!-- VITAL SIGNS PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[0].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Vital Signs</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >equalizer</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
<!--            <div *ngIf="task.subtasks[0].completed; else notcomplete">-->
<!--              <mat-panel-description>Selected</mat-panel-description>-->
<!--            </div>-->
          </mat-expansion-panel-header>
          <div *ngIf="(vitalsBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- SOCIAL HISTORY PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[1].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Social Hisotry</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >smoking_rooms</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[1].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(socialBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- LABORATORY PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[2].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Laboratory</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >science</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[2].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(labBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- MEDICAL STATEMENT PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[3].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Medical Statement</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >medication</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[3].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(medBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- IMMUNIZATION PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[4].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Immunization</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >coronavirus</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[4].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>

          <br>
          <div *ngIf="(immuneBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- CONDITIONS PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[5].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Conditions</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >local_hospital</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[5].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(conditionBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- PROCEDURES PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[6].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Procedures</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >healing</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[6].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(procedureBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

        <!-- DOCUMENT PANEL -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              <mat-checkbox [(ngModel)]="task.subtasks[7].completed"
                            (click)="$event.stopPropagation()"
                            (keydown)="$event.stopPropagation()"
                            color="primary"
                            (ngModelChange)="updateAllComplete()">
                <span>Documents</span> &nbsp;&nbsp;&nbsp;
                <mat-icon >description</mat-icon>
              </mat-checkbox>
            </mat-panel-title>
            <!-- <div *ngIf="task.subtasks[7].completed; else notcomplete">
              <mat-panel-description>Selected</mat-panel-description>
            </div> -->
          </mat-expansion-panel-header>
          <br>
          <div *ngIf="(documentBundle | async) as bundle; else loading">
            <app-obs-value-list [observations]="bundle"></app-obs-value-list>
          </div>
        </mat-expansion-panel>

      </mat-accordion>

      <button mat-raised-button color="primary" (click)="submitData()">Submit</button>

      <!-- <div *ngIf="(obsBundle | async) as bundle">
        <app-obs-value-list [observations]="bundle"></app-obs-value-list>
      </div> -->
      <a mat-button href="https://www.hl7.org/fhir/valueset-observation-category.html" target="_blank">FHIR
        Categories</a>
    </div>
  </mat-card-content>
</mat-card>

<ng-template #loading><br>Error retrieving information.</ng-template>
<ng-template #notcomplete>
  <mat-panel-description fxLayoutAlign="end">Not Selected</mat-panel-description>
</ng-template>
